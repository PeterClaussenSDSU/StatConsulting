---
title: "Practicum 1 Analysis"
author:
- Peter Claussen
- Ben Derenge
- Stephanie Liebl
date: "9/16/2021"
output:
  pdf_document: default
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



# Analysis

## Data Processing

```{r}
metrics.dat <- read.csv('Practicum 1 Data.csv',header=TRUE)
metrics.dat <- metrics.dat[!is.na(metrics.dat$Snumber),]

metrics.dat$CalcTMM <- with(metrics.dat, 8*Vig.ex.Time + 4*Mod.ex.time + 3.3*Walk.ex.Time)

metrics.dat$shift[metrics.dat$shift==''] <- 'missing'
shift.levels <- c(paste(c(7:11),'am',sep=''),paste(c(12,1:2),'pm',sep=''),'other','missing')
metrics.dat$shift <- factor(metrics.dat$shift,shift.levels)
summary(metrics.dat$shift)
```

```{r}
metrics.dat$MissingLbs <- is.na(metrics.dat$pounds_gained)
table(metrics.dat$MissingLbs,metrics.dat$weightgain)
```


We consider two subsets for analysis. First we create a data table that has appropriate values for `weightgain`. This will be the larger of the two data sets.

```{r}
gained.dat <- metrics.dat[metrics.dat$weightgain %in% c('Yes','No'),]
gained.dat$WG <- FALSE
gained.dat$WG[gained.dat$weightgain=='Yes'] <- TRUE
gained.dat$pounds_gained[!gained.dat$WG] <- 0
dim(gained.dat)
gained.dat$MissingLbs <- is.na(gained.dat$pounds_gained)
table(gained.dat$MissingLbs,gained.dat$weightgain)

gained.dat <- gained.dat[!is.na(gained.dat$CalcTMM),]
dim(gained.dat)
```

```{r}
#gained.dat <- gained.dat[!gained.dat$MissingLbs,]
dim(gained.dat)
```

```{r}
par(mfrow=c(1,2))
boxplot(pounds_gained ~ WG,data=gained.dat,horizontal = TRUE)
plot(WG~CalcTMM,data=gained.dat)
```
# Analysis of Binary Response (WG)

## **(SA1)** Does *total metabolic minutes* have an effect on *weight gain*?

### Simple logistic regression

```{r}
SA1.model1 <- glm(WG ~ CalcTMM, data=gained.dat,family = binomial)
summary(SA1.model1)
par(mfrow=c(2,2))
plot(SA1.model1)
```

- **(SA2)** Does *shift* have an effect on *weight gain*?

```{r}
SA2.model1 <- glm(WG ~ shift, data=gained.dat,family = binomial)
summary(SA2.model1)
par(mfrow=c(2,2))
plot(SA2.model1)
```

# Model 2 Interactions

```{r}
SA12.model2 <- glm(WG ~ shift+CalcTMM, data=gained.dat,family = binomial)
summary(SA12.model2)
```

# Model 3 SA1 and 2 plus anthropometric variables


```{r}
SA12.model3a <- glm(WG ~ gender + Age + shift + CalcTMM, data=gained.dat,family = binomial)
summary(SA12.model3a)
```

```{r}
SA12.model3b <- glm(WG ~ gender + Age + height +shift + CalcTMM, data=gained.dat,family = binomial)
summary(SA12.model3b)
```

# Model 4 Partition CalcTMM into components


```{r}
SA12.model4a <- glm(WG ~ gender + Age + shift + Vig.ex.Time  + Mod.ex.time + Walk.ex.Time, data=gained.dat,family = binomial)
summary(SA12.model4a)
```

```{r}
SA12.model4b <- glm(WG ~ gender + Age + height + shift + Vig.ex.Time  + Mod.ex.time + Walk.ex.Time, data=gained.dat,family = binomial)
summary(SA12.model4b)
```


# Model 5 - Model 4 plus BMI and initial body weight

For these models, we may include BMI, or just the anthropometric variables used to calculate BMI
```{r}
gained.dat['initial_bweight'] <- gained.dat$bweight - gained.dat$pounds_gained
gained.dat['initial_BMI'] <- (gained.dat$initial_bweight / (gained.dat$height)^2)*703
```

```{r}
SA12.model4a <- glm(WG ~ gender + Age + shift + Vig.ex.Time  + Mod.ex.time + Walk.ex.Time + initial_BMI, data=gained.dat,family = binomial)
summary(SA12.model4a)
```

```{r}
SA12.model4b <- glm(WG ~ gender + Age + height + shift + Vig.ex.Time  + Mod.ex.time + Walk.ex.Time +initial_bweight, data=gained.dat,family = binomial)
summary(SA12.model4b)
```

```{r,eval=FALSE,echo=FALSE,include=FALSE,warning=FALSE}
library(MASS)
best.modela <- stepAIC(SA12.model4a, direction = "both")
summary(best.modela)
best.modelb <- stepAIC(SA12.model4b, direction = "both")
summary(best.modelb)
```


# Pounds Gained analysis


```{r}
gained.dat$LBS <- round(gained.dat$pounds_gained)
```

### Simple gaussian model for pounds gained, with 'No' coded as 0
```{r}
SA1.model1.lm <- lm(pounds_gained ~ CalcTMM, data=gained.dat)
summary(SA1.model1.lm)
par(mfrow=c(2,2))
plot(SA1.model1.lm)
```

```{r}
SA1.model1.gauss <- glm(pounds_gained ~ CalcTMM, data=gained.dat,family = gaussian)
summary(SA1.model1.gauss)
par(mfrow=c(2,2))
plot(SA1.model1.gauss)
```

```{r}
#error in log(0)
SA1.model1.log <- lm(log(pounds_gained+0.1) ~ CalcTMM, data=gained.dat)
summary(SA1.model1.log)
par(mfrow=c(2,2))
plot(SA1.model1.log)
```

```{r}
#error in log(0)
SA1.model1.loggauss <- glm(pounds_gained+0.01 ~ Total_Met_Min, data=gained.dat,family = gaussian(link="log"))
par(mfrow=c(2,2))
plot(SA1.model1.loggauss)
```
### Poisson family

```{r}
SA1.model1.LBS <- glm(LBS ~ CalcTMM, data=gained.dat,family = poisson)
summary(SA1.model1.LBS)
par(mfrow=c(2,2))
plot(SA1.model1.LBS)
```

```{r}
SA1.model1.quasi <- glm(pounds_gained ~ CalcTMM, data=gained.dat,family = quasipoisson)
summary(SA1.model1.quasi)
par(mfrow=c(2,2))
plot(SA1.model1.quasi)
```

```{r}
library(pscl)
summary(zero.model1 <- zeroinfl(LBS ~ CalcTMM, data = gained.dat))
```

```{r}
#SA1.model1.inv <- glm(LBS ~ Total_Met_Min, data=gained.dat,family = inverse.gaussian)
#summary(SA1.model1.inv)

SA1.model1.Gamma <- glm(LBS+0.01 ~ Total_Met_Min, data=gained.dat,family = Gamma)
summary(SA1.model1.Gamma)

#SA1.model1.GammaId <- glm(LBS ~ Total_Met_Min, data=gained.dat,family = Gamma(link="identity"))
#summary(SA1.model1.GammaId)
#SA1.model1.GammaId <- glm(LBS ~ Total_Met_Min, data=gained.dat,family = Gamma(link="log"))
#summary(SA1.model1.GammaId)
```


```{r,eval=FALSE}
par(mfrow=c(1,1))
hist(gained.dat$pounds_gained, freq = FALSE,ylim=c(0,max(dpois(0:70, mean(gained.dat$pounds_gained)))))

mean(gained.dat$pounds_gained)
sd(gained.dat$pounds_gained)
100*abs(sd(gained.dat$pounds_gained)-mean(gained.dat$pounds_gained))/mean(gained.dat$pounds_gained)
lines(0:70,dpois(0:70,mean(gained.dat$pounds_gained)),col='red')


nonzero <- gained.dat$pounds_gained[gained.dat$pounds_gained>2]

hist(nonzero, freq = FALSE,ylim=c(0,max(dpois(0:70, mean(nonzero)))))
lines(0:70,dpois(0:70,mean(nonzero)),col='red')
mean(nonzero)
sd(nonzero)
100*abs(sd(nonzero)-mean(nonzero))/mean(nonzero)
```

```{r,eval=FALSE}
colors <- rep('red',dim(gained.dat)[1]) 
colors[gained.dat$pounds_gained==0] <- 'blue'
plot(pounds_gained~Total_Met_Min,gained.dat,col=colors)
abline(lm(pounds_gained~Total_Met_Min,gained.dat))
abline(lm(pounds_gained~Total_Met_Min,gained.dat[gained.dat$gained.dat>0,]),col='red')
```


```{r}
SA1.model1.quasi <- update(SA1.model1.LBS, family=quasipoisson)
summary(SA1.model1.quasi)
```





```{r}
SA1.model2.gauss <- glm(pounds_gained ~ gender + Age + height + shift + CalcTMM, data=gained.dat,family = gaussian)
summary(SA1.model2.gauss)
SA1.model3.gauss <- glm(pounds_gained ~ gender + Age + height + shift + Vig.ex.Time  + Mod.ex.time + Walk.ex.Time, data=gained.dat, family = gaussian)
summary(SA1.model3.gauss)
```

```{r,eval=FALSE,echo=FALSE,include=FALSE,warning=FALSE}
best.model.gauss.lbs <- stepAIC(SA1.model3, direction = "both")

summary(best.model.gauss.lbs)
```

```{r}
SA1.model2.LBS <- glm(LBS ~ gender + Age + height+ initial_BMI + shift + CalcTMM, data=gained.dat,family = poisson)
summary(SA1.model2.LBS)
SA1.model3.LBS <- glm(LBS ~ gender + Age + height+ initial_BMI + shift + Vig.ex.Time  + Mod.ex.time + Walk.ex.Time, data=gained.dat, family = poisson)
summary(SA1.model3.LBS)
```

```{r,eval=FALSE,echo=FALSE,include=FALSE,warning=FALSE}
best.model.LBS <- stepAIC(SA1.model3, direction = "both")
par(mfrow=c(2,2))
plot(best.model.LBS)
summary(best.model.LBS)
```






```{r,eval=FALSE}
best.model.quasi <- update(best.model.LBS,family=quasipoisson)

#par(mfrow=c(2,2))
#plot(best.model.quasi)
summary(best.model.quasi)
```

# Zero-Inflated Poisson

```{r}
# We can't use initial BMI, no 0 values
summary(zero.model2 <- zeroinfl(LBS ~ gender +  + Age + + height + shift + CalcTMM, data = gained.dat))
```

```{r}
summary(zero.model3 <- zeroinfl(LBS ~ gender + Age + height + shift + Vig.ex.Time + Mod.ex.time + Walk.ex.Time, data = gained.dat))
```

Bootstrap the coefficients

```{r,eval=FALSE,echo=FALSE,include=FALSE}
set.seed(10)

boots.zero.model1 <- NULL
for(i in 1:1000) {
  k <- sample(1:dim(gained.dat)[1],replace=TRUE)
  current <- update(zero.model1,data=gained.dat[k,])
  boots.zero.model1 <- rbind(boots.zero.model1,t(coef(current)))
}
q.fn <- function(x) {quantile(x, c(0.025,0.975))}
boots.zero.model1.tbl <- data.frame(t(apply(boots.zero.model1,2,q.fn)))
boots.zero.model1.tbl$Sig <- ' '
boots.zero.model1.tbl$Sig[sign(boots.zero.model1.tbl[,1])==sign(boots.zero.model1.tbl[,2])] <- '*'
```

```{r,eval=FALSE}
boots.zero.model1.tbl$Estimate <- coef(zero.model1)
boots.zero.model1.tbl

confint(zero.model1)
```

```{r,eval=FALSE,echo=FALSE,include=FALSE}
boots.zero.model3 <- NULL
for(i in 1:1000) {
  k <- sample(1:dim(gained.dat)[1],replace=TRUE)
  current <- update(zero.model3,data=gained.dat[k,])
  boots.zero.model1 <- rbind(boots.zero.model3,t(coef(current)))
}
boots.zero.model3.tbl <- data.frame(t(apply(boots.zero.model1,2,q.fn)))
boots.zero.model3.tbl$Sig <- ' '
boots.zero.model3.tbl$Sig[sign(boots.zero.model3.tbl[,1])==sign(boots.zero.model3.tbl[,2])] <- '*'

boots.zero.model3.tbl$Estimate <- coef(zero.model3)
boots.zero.model3.tbl

confint(zero.model3)

```
